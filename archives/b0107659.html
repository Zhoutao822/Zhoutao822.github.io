<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://zhoutao822.coding.me').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="参考：  Gson User Guide  json是一种数据格式，类似与键值对的形式，常用于服务器与客户端之间数据传输，以键值对形式传输的数据在客户端进行解析时必然需要对不同的key寻找其对应的value，通常来说这种解析数据的过程非常繁琐，但是没有难度，所以Google推出了Gson这个工具，用于解析json数据并直接将其实例化。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android框架-Gson">
<meta property="og:url" content="http://zhoutao822.coding.me/archives/b0107659.html">
<meta property="og:site_name" content="Tao">
<meta property="og:description" content="参考：  Gson User Guide  json是一种数据格式，类似与键值对的形式，常用于服务器与客户端之间数据传输，以键值对形式传输的数据在客户端进行解析时必然需要对不同的key寻找其对应的value，通常来说这种解析数据的过程非常繁琐，但是没有难度，所以Google推出了Gson这个工具，用于解析json数据并直接将其实例化。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-07-20T15:09:12.000Z">
<meta property="article:modified_time" content="2020-01-17T15:07:46.301Z">
<meta property="article:author" content="Tao Zhou">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Gson">
<meta property="article:tag" content="json">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://zhoutao822.coding.me/archives/b0107659.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Android框架-Gson | Tao</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Tao" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tao</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhoutao822.coding.me/archives/b0107659.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Tao Zhou">
      <meta itemprop="description" content="学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tao">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android框架-Gson
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-20 23:09:12" itemprop="dateCreated datePublished" datetime="2019-07-20T23:09:12+08:00">2019-07-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-17 23:07:46" itemprop="dateModified" datetime="2020-01-17T23:07:46+08:00">2020-01-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>
            </span>

          
            <span id="/archives/b0107659.html" class="post-meta-item leancloud_visitors" data-flag-title="Android框架-Gson" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/b0107659.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/b0107659.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>39k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>36 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>参考：</p>
<blockquote>
<p><a href="https://github.com/google/gson/blob/master/UserGuide.md" target="_blank" rel="noopener">Gson User Guide</a></p>
</blockquote>
<p>json是一种数据格式，类似与键值对的形式，常用于服务器与客户端之间数据传输，以键值对形式传输的数据在客户端进行解析时必然需要对不同的key寻找其对应的value，通常来说这种解析数据的过程非常繁琐，但是没有难度，所以Google推出了Gson这个工具，用于解析json数据并直接将其实例化。</p>
<a id="more"></a>
<h2 id="1-Gson使用"><a href="#1-Gson使用" class="headerlink" title="1. Gson使用"></a>1. Gson使用</h2><p>以解析和风天气的数据为例，请求返回的json数据如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"HeWeather6"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"basic"</span>: &#123;</span><br><span class="line">                <span class="attr">"cid"</span>: <span class="string">"CN101010100"</span>,</span><br><span class="line">                <span class="attr">"location"</span>: <span class="string">"北京"</span>,</span><br><span class="line">                <span class="attr">"parent_city"</span>: <span class="string">"北京"</span>,</span><br><span class="line">                <span class="attr">"admin_area"</span>: <span class="string">"北京"</span>,</span><br><span class="line">                <span class="attr">"cnty"</span>: <span class="string">"中国"</span>,</span><br><span class="line">                <span class="attr">"lat"</span>: <span class="string">"39.90498734"</span>,</span><br><span class="line">                <span class="attr">"lon"</span>: <span class="string">"116.4052887"</span>,</span><br><span class="line">                <span class="attr">"tz"</span>: <span class="string">"+8.00"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"update"</span>: &#123;</span><br><span class="line">                <span class="attr">"loc"</span>: <span class="string">"2019-07-18 16:45"</span>,</span><br><span class="line">                <span class="attr">"utc"</span>: <span class="string">"2019-07-18 08:45"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"status"</span>: <span class="string">"ok"</span>,</span><br><span class="line">            <span class="attr">"now"</span>: &#123;</span><br><span class="line">                <span class="attr">"cloud"</span>: <span class="string">"10"</span>,</span><br><span class="line">                <span class="attr">"cond_code"</span>: <span class="string">"101"</span>,</span><br><span class="line">                <span class="attr">"cond_txt"</span>: <span class="string">"多云"</span>,</span><br><span class="line">                <span class="attr">"fl"</span>: <span class="string">"35"</span>,</span><br><span class="line">                <span class="attr">"hum"</span>: <span class="string">"54"</span>,</span><br><span class="line">                <span class="attr">"pcpn"</span>: <span class="string">"0.0"</span>,</span><br><span class="line">                <span class="attr">"pres"</span>: <span class="string">"1000"</span>,</span><br><span class="line">                <span class="attr">"tmp"</span>: <span class="string">"32"</span>,</span><br><span class="line">                <span class="attr">"vis"</span>: <span class="string">"6"</span>,</span><br><span class="line">                <span class="attr">"wind_deg"</span>: <span class="string">"279"</span>,</span><br><span class="line">                <span class="attr">"wind_dir"</span>: <span class="string">"西风"</span>,</span><br><span class="line">                <span class="attr">"wind_sc"</span>: <span class="string">"1"</span>,</span><br><span class="line">                <span class="attr">"wind_spd"</span>: <span class="string">"3"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>1.构造对应json数据的实体类，这里使用的Android Studio的插件GsonFormat，可以直接根据json数据生成代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeatherEntity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;HeWeather6Bean&gt; HeWeather6;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;HeWeather6Bean&gt; <span class="title">getHeWeather6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> HeWeather6;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeWeather6</span><span class="params">(List&lt;HeWeather6Bean&gt; HeWeather6)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.HeWeather6 = HeWeather6;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 重写以下toString方法，便于后续观察数据传输是否正确</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> HeWeather6.get(<span class="number">0</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HeWeather6Bean</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * basic : &#123;"cid":"CN101010100","location":"北京","parent_city":"北京","admin_area":"北京","cnty":"中国","lat":"39.90498734","lon":"116.4052887","tz":"+8.00"&#125;</span></span><br><span class="line"><span class="comment">         * update : &#123;"loc":"2019-07-18 16:45","utc":"2019-07-18 08:45"&#125;</span></span><br><span class="line"><span class="comment">         * status : ok</span></span><br><span class="line"><span class="comment">         * now : &#123;"cloud":"10","cond_code":"101","cond_txt":"多云","fl":"35","hum":"54","pcpn":"0.0","pres":"1000","tmp":"32","vis":"6","wind_deg":"279","wind_dir":"西风","wind_sc":"1","wind_spd":"3"&#125;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> BasicBean basic;</span><br><span class="line">        <span class="keyword">private</span> UpdateBean update;</span><br><span class="line">        <span class="keyword">private</span> String status;</span><br><span class="line">        <span class="keyword">private</span> NowBean now;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@NonNull</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> status + <span class="string">" \n "</span> + basic.toString() + <span class="string">" \n "</span> + update.toString() + <span class="string">" \n "</span> + now.toString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> BasicBean <span class="title">getBasic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> basic;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBasic</span><span class="params">(BasicBean basic)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.basic = basic;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> UpdateBean <span class="title">getUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> update;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpdate</span><span class="params">(UpdateBean update)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.update = update;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(String status)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.status = status;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> NowBean <span class="title">getNow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> now;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNow</span><span class="params">(NowBean now)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.now = now;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicBean</span> </span>&#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * cid : CN101010100</span></span><br><span class="line"><span class="comment">             * location : 北京</span></span><br><span class="line"><span class="comment">             * parent_city : 北京</span></span><br><span class="line"><span class="comment">             * admin_area : 北京</span></span><br><span class="line"><span class="comment">             * cnty : 中国</span></span><br><span class="line"><span class="comment">             * lat : 39.90498734</span></span><br><span class="line"><span class="comment">             * lon : 116.4052887</span></span><br><span class="line"><span class="comment">             * tz : +8.00</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> String cid;</span><br><span class="line">            <span class="keyword">private</span> String location;</span><br><span class="line">            <span class="keyword">private</span> String parent_city;</span><br><span class="line">            <span class="keyword">private</span> String admin_area;</span><br><span class="line">            <span class="keyword">private</span> String cnty;</span><br><span class="line">            <span class="keyword">private</span> String lat;</span><br><span class="line">            <span class="keyword">private</span> String lon;</span><br><span class="line">            <span class="keyword">private</span> String tz;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@NonNull</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"cid : "</span> + cid + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"location : "</span> + location + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"parent_city : "</span> + parent_city + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"admin_area : "</span> + admin_area + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"cnty : "</span> + cnty + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"lat : "</span> + lat + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"lon : "</span> + lon + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"tz : "</span> + tz + <span class="string">"\n"</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getCid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> cid;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCid</span><span class="params">(String cid)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.cid = cid;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getLocation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> location;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocation</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.location = location;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getParent_city</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> parent_city;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParent_city</span><span class="params">(String parent_city)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.parent_city = parent_city;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getAdmin_area</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> admin_area;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdmin_area</span><span class="params">(String admin_area)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.admin_area = admin_area;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getCnty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> cnty;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCnty</span><span class="params">(String cnty)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.cnty = cnty;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getLat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> lat;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLat</span><span class="params">(String lat)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.lat = lat;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getLon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> lon;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLon</span><span class="params">(String lon)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.lon = lon;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getTz</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> tz;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTz</span><span class="params">(String tz)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.tz = tz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UpdateBean</span> </span>&#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * loc : 2019-07-18 16:45</span></span><br><span class="line"><span class="comment">             * utc : 2019-07-18 08:45</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> String loc;</span><br><span class="line">            <span class="keyword">private</span> String utc;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@NonNull</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"loc : "</span> + loc + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"utc : "</span> + utc + <span class="string">"\n"</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getLoc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> loc;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLoc</span><span class="params">(String loc)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.loc = loc;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getUtc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> utc;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUtc</span><span class="params">(String utc)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.utc = utc;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">NowBean</span> </span>&#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * cloud : 10</span></span><br><span class="line"><span class="comment">             * cond_code : 101</span></span><br><span class="line"><span class="comment">             * cond_txt : 多云</span></span><br><span class="line"><span class="comment">             * fl : 35</span></span><br><span class="line"><span class="comment">             * hum : 54</span></span><br><span class="line"><span class="comment">             * pcpn : 0.0</span></span><br><span class="line"><span class="comment">             * pres : 1000</span></span><br><span class="line"><span class="comment">             * tmp : 32</span></span><br><span class="line"><span class="comment">             * vis : 6</span></span><br><span class="line"><span class="comment">             * wind_deg : 279</span></span><br><span class="line"><span class="comment">             * wind_dir : 西风</span></span><br><span class="line"><span class="comment">             * wind_sc : 1</span></span><br><span class="line"><span class="comment">             * wind_spd : 3</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> String cloud;</span><br><span class="line">            <span class="keyword">private</span> String cond_code;</span><br><span class="line">            <span class="keyword">private</span> String cond_txt;</span><br><span class="line">            <span class="keyword">private</span> String fl;</span><br><span class="line">            <span class="keyword">private</span> String hum;</span><br><span class="line">            <span class="keyword">private</span> String pcpn;</span><br><span class="line">            <span class="keyword">private</span> String pres;</span><br><span class="line">            <span class="keyword">private</span> String tmp;</span><br><span class="line">            <span class="keyword">private</span> String vis;</span><br><span class="line">            <span class="keyword">private</span> String wind_deg;</span><br><span class="line">            <span class="keyword">private</span> String wind_dir;</span><br><span class="line">            <span class="keyword">private</span> String wind_sc;</span><br><span class="line">            <span class="keyword">private</span> String wind_spd;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@NonNull</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"cloud : "</span> + cloud + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"cond_code : "</span> + cond_code + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"cond_txt : "</span> + cond_txt + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"fl : "</span> + fl + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"hum : "</span> + hum + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"pcpn : "</span> + pcpn + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"pres : "</span> + pres + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"tmp : "</span> + tmp + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"vis : "</span> + vis + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"wind_deg : "</span> + wind_deg + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"wind_dir : "</span> + wind_dir + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"wind_sc : "</span> + wind_sc + <span class="string">"\n"</span> +</span><br><span class="line">                        <span class="string">"wind_spd : "</span> + wind_spd + <span class="string">"\n"</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getCloud</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> cloud;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCloud</span><span class="params">(String cloud)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.cloud = cloud;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getCond_code</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> cond_code;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCond_code</span><span class="params">(String cond_code)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.cond_code = cond_code;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getCond_txt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> cond_txt;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCond_txt</span><span class="params">(String cond_txt)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.cond_txt = cond_txt;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getFl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> fl;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFl</span><span class="params">(String fl)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.fl = fl;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getHum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> hum;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHum</span><span class="params">(String hum)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.hum = hum;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getPcpn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> pcpn;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPcpn</span><span class="params">(String pcpn)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.pcpn = pcpn;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getPres</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> pres;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPres</span><span class="params">(String pres)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.pres = pres;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getTmp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> tmp;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTmp</span><span class="params">(String tmp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.tmp = tmp;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getVis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> vis;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVis</span><span class="params">(String vis)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.vis = vis;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getWind_deg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> wind_deg;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWind_deg</span><span class="params">(String wind_deg)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.wind_deg = wind_deg;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getWind_dir</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> wind_dir;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWind_dir</span><span class="params">(String wind_dir)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.wind_dir = wind_dir;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getWind_sc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> wind_sc;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWind_sc</span><span class="params">(String wind_sc)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.wind_sc = wind_sc;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getWind_spd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> wind_spd;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWind_spd</span><span class="params">(String wind_spd)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.wind_spd = wind_spd;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>2.使用OkHttp构造请求</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .get()</span><br><span class="line">        .url(baseUrl)</span><br><span class="line">        .build();</span><br><span class="line">Call call = client.newCall(request);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(@NotNull Call call, @NotNull IOException e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(@NotNull Call call, @NotNull Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>3.在onResponse方法中处理请求，使用Gson对response的json数据进行实例化</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(@NotNull Call call, @NotNull Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String ret = response.body().string();</span><br><span class="line">    runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">            WeatherEntity weatherEntity = gson.fromJson(ret, WeatherEntity<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            textView.setText(weatherEntity.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只要对比一下就知道了，从ret到weatherEntity，完成了对json数据的实例化，我们不需要new一个对象再通过set方法赋值就可以得到一个实例，最后直接使用此实例即可。</p>
<h2 id="2-Gson源码分析"><a href="#2-Gson源码分析" class="headerlink" title="2. Gson源码分析"></a>2. Gson源码分析</h2><p>首先new了一个Gson对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Gson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(Excluder.DEFAULT, FieldNamingPolicy.IDENTITY,</span><br><span class="line">        Collections.&lt;Type, InstanceCreator&lt;?&gt;&gt;emptyMap(), DEFAULT_SERIALIZE_NULLS,</span><br><span class="line">        DEFAULT_COMPLEX_MAP_KEYS, DEFAULT_JSON_NON_EXECUTABLE, DEFAULT_ESCAPE_HTML,</span><br><span class="line">        DEFAULT_PRETTY_PRINT, DEFAULT_LENIENT, DEFAULT_SPECIALIZE_FLOAT_VALUES,</span><br><span class="line">        LongSerializationPolicy.DEFAULT, <span class="keyword">null</span>, DateFormat.DEFAULT, DateFormat.DEFAULT,</span><br><span class="line">        Collections.&lt;TypeAdapterFactory&gt;emptyList(), Collections.&lt;TypeAdapterFactory&gt;emptyList(),</span><br><span class="line">        Collections.&lt;TypeAdapterFactory&gt;emptyList());</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 这里很明显，比较重要的类是TypeAdapterFactory，作用稍后再说</span></span><br><span class="line">  Gson(<span class="keyword">final</span> Excluder excluder, <span class="keyword">final</span> FieldNamingStrategy fieldNamingStrategy,</span><br><span class="line">      <span class="keyword">final</span> Map&lt;Type, InstanceCreator&lt;?&gt;&gt; instanceCreators, <span class="keyword">boolean</span> serializeNulls,</span><br><span class="line">      <span class="keyword">boolean</span> complexMapKeySerialization, <span class="keyword">boolean</span> generateNonExecutableGson, <span class="keyword">boolean</span> htmlSafe,</span><br><span class="line">      <span class="keyword">boolean</span> prettyPrinting, <span class="keyword">boolean</span> lenient, <span class="keyword">boolean</span> serializeSpecialFloatingPointValues,</span><br><span class="line">      LongSerializationPolicy longSerializationPolicy, String datePattern, <span class="keyword">int</span> dateStyle,</span><br><span class="line">      <span class="keyword">int</span> timeStyle, List&lt;TypeAdapterFactory&gt; builderFactories,</span><br><span class="line">      List&lt;TypeAdapterFactory&gt; builderHierarchyFactories,</span><br><span class="line">      List&lt;TypeAdapterFactory&gt; factoriesToBeAdded) &#123;</span><br><span class="line">    <span class="keyword">this</span>.excluder = excluder;</span><br><span class="line">    <span class="keyword">this</span>.fieldNamingStrategy = fieldNamingStrategy;</span><br><span class="line">    <span class="keyword">this</span>.instanceCreators = instanceCreators;</span><br><span class="line">    <span class="keyword">this</span>.constructorConstructor = <span class="keyword">new</span> ConstructorConstructor(instanceCreators);</span><br><span class="line">    <span class="keyword">this</span>.serializeNulls = serializeNulls;</span><br><span class="line">    <span class="keyword">this</span>.complexMapKeySerialization = complexMapKeySerialization;</span><br><span class="line">    <span class="keyword">this</span>.generateNonExecutableJson = generateNonExecutableGson;</span><br><span class="line">    <span class="keyword">this</span>.htmlSafe = htmlSafe;</span><br><span class="line">    <span class="keyword">this</span>.prettyPrinting = prettyPrinting;</span><br><span class="line">    <span class="keyword">this</span>.lenient = lenient;</span><br><span class="line">    <span class="keyword">this</span>.serializeSpecialFloatingPointValues = serializeSpecialFloatingPointValues;</span><br><span class="line">    <span class="keyword">this</span>.longSerializationPolicy = longSerializationPolicy;</span><br><span class="line">    <span class="keyword">this</span>.datePattern = datePattern;</span><br><span class="line">    <span class="keyword">this</span>.dateStyle = dateStyle;</span><br><span class="line">    <span class="keyword">this</span>.timeStyle = timeStyle;</span><br><span class="line">    <span class="keyword">this</span>.builderFactories = builderFactories;</span><br><span class="line">    <span class="keyword">this</span>.builderHierarchyFactories = builderHierarchyFactories;</span><br><span class="line"></span><br><span class="line">    List&lt;TypeAdapterFactory&gt; factories = <span class="keyword">new</span> ArrayList&lt;TypeAdapterFactory&gt;();</span><br><span class="line">    <span class="comment">// 内置的TypeAdapter，比如ObjectTypeAdapter用于处理Object类型数据</span></span><br><span class="line">    <span class="comment">// built-in type adapters that cannot be overridden</span></span><br><span class="line">    factories.add(TypeAdapters.JSON_ELEMENT_FACTORY);</span><br><span class="line">    factories.add(ObjectTypeAdapter.FACTORY);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// excluder用于控制属性的是否支持序列化与反序列化，比如用@Expose修饰的属性，</span></span><br><span class="line">    <span class="comment">// 优先级必须在所有TypeAdapter之前</span></span><br><span class="line">    <span class="comment">// the excluder must precede all adapters that handle user-defined types</span></span><br><span class="line">    factories.add(excluder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开发人员自定义的TypeAdapter，优先级相对较高</span></span><br><span class="line">    <span class="comment">// users' type adapters</span></span><br><span class="line">    factories.addAll(factoriesToBeAdded);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 基础类型数据，包括String、Integer等包装类型</span></span><br><span class="line">    <span class="comment">// type adapters for basic platform types</span></span><br><span class="line">    factories.add(TypeAdapters.STRING_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.INTEGER_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.BOOLEAN_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.BYTE_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.SHORT_FACTORY);</span><br><span class="line">    TypeAdapter&lt;Number&gt; longAdapter = longAdapter(longSerializationPolicy);</span><br><span class="line">    factories.add(TypeAdapters.newFactory(<span class="keyword">long</span><span class="class">.<span class="keyword">class</span>, <span class="title">Long</span>.<span class="title">class</span>, <span class="title">longAdapter</span>))</span>;</span><br><span class="line">    factories.add(TypeAdapters.newFactory(<span class="keyword">double</span><span class="class">.<span class="keyword">class</span>, <span class="title">Double</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">            <span class="title">doubleAdapter</span>(<span class="title">serializeSpecialFloatingPointValues</span>)))</span>;</span><br><span class="line">    factories.add(TypeAdapters.newFactory(<span class="keyword">float</span><span class="class">.<span class="keyword">class</span>, <span class="title">Float</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">            <span class="title">floatAdapter</span>(<span class="title">serializeSpecialFloatingPointValues</span>)))</span>;</span><br><span class="line">    factories.add(TypeAdapters.NUMBER_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.ATOMIC_INTEGER_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.ATOMIC_BOOLEAN_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.newFactory(AtomicLong<span class="class">.<span class="keyword">class</span>, <span class="title">atomicLongAdapter</span>(<span class="title">longAdapter</span>)))</span>;</span><br><span class="line">    factories.add(TypeAdapters.newFactory(AtomicLongArray<span class="class">.<span class="keyword">class</span>, <span class="title">atomicLongArrayAdapter</span>(<span class="title">longAdapter</span>)))</span>;</span><br><span class="line">    factories.add(TypeAdapters.ATOMIC_INTEGER_ARRAY_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.CHARACTER_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.STRING_BUILDER_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.STRING_BUFFER_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.newFactory(BigDecimal<span class="class">.<span class="keyword">class</span>, <span class="title">TypeAdapters</span>.<span class="title">BIG_DECIMAL</span>))</span>;</span><br><span class="line">    factories.add(TypeAdapters.newFactory(BigInteger<span class="class">.<span class="keyword">class</span>, <span class="title">TypeAdapters</span>.<span class="title">BIG_INTEGER</span>))</span>;</span><br><span class="line">    factories.add(TypeAdapters.URL_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.URI_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.UUID_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.CURRENCY_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.LOCALE_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.INET_ADDRESS_FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.BIT_SET_FACTORY);</span><br><span class="line">    factories.add(DateTypeAdapter.FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.CALENDAR_FACTORY);</span><br><span class="line">    factories.add(TimeTypeAdapter.FACTORY);</span><br><span class="line">    factories.add(SqlDateTypeAdapter.FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.TIMESTAMP_FACTORY);</span><br><span class="line">    factories.add(ArrayTypeAdapter.FACTORY);</span><br><span class="line">    factories.add(TypeAdapters.CLASS_FACTORY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 集合类型优先级较低，包括Map、Collection等</span></span><br><span class="line">    <span class="comment">// type adapters for composite and user-defined types</span></span><br><span class="line">    factories.add(<span class="keyword">new</span> CollectionTypeAdapterFactory(constructorConstructor));</span><br><span class="line">    factories.add(<span class="keyword">new</span> MapTypeAdapterFactory(constructorConstructor, complexMapKeySerialization));</span><br><span class="line">    <span class="keyword">this</span>.jsonAdapterFactory = <span class="keyword">new</span> JsonAdapterAnnotationTypeAdapterFactory(constructorConstructor);</span><br><span class="line">    factories.add(jsonAdapterFactory);</span><br><span class="line">    factories.add(TypeAdapters.ENUM_FACTORY);</span><br><span class="line">    <span class="comment">// 反射类型优先级最低，而这个反射类型就是我们自定义WeatherEntity的TypeAdapter</span></span><br><span class="line">    factories.add(<span class="keyword">new</span> ReflectiveTypeAdapterFactory(</span><br><span class="line">        constructorConstructor, fieldNamingStrategy, excluder, jsonAdapterFactory));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.factories = Collections.unmodifiableList(factories);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>然后直接看fromJson方法，传入的参数为String和.class，返回值为.class的实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">fromJson</span><span class="params">(String json, Class&lt;T&gt; classOfT)</span> <span class="keyword">throws</span> JsonSyntaxException </span>&#123;</span><br><span class="line">  <span class="comment">// 此处只要分析fromJson方法</span></span><br><span class="line">  Object object = fromJson(json, (Type) classOfT);</span><br><span class="line">  <span class="comment">// wrap仅仅把基础类型转为包装类型，cast用于类型转换，把Object类型转为object的实际类型</span></span><br><span class="line">  <span class="keyword">return</span> Primitives.wrap(classOfT).cast(object);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">fromJson</span><span class="params">(String json, Type typeOfT)</span> <span class="keyword">throws</span> JsonSyntaxException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (json == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 通过StringReader将String类型的json数据转为StringReader</span></span><br><span class="line">  StringReader reader = <span class="keyword">new</span> StringReader(json);</span><br><span class="line">  <span class="comment">// 又调用fromJson方法</span></span><br><span class="line">  T target = (T) fromJson(reader, typeOfT);</span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">fromJson</span><span class="params">(Reader json, Type typeOfT)</span> <span class="keyword">throws</span> JsonIOException, JsonSyntaxException </span>&#123;</span><br><span class="line">  <span class="comment">// 又将StringReader转为JsonReader</span></span><br><span class="line">  JsonReader jsonReader = newJsonReader(json);</span><br><span class="line">  <span class="comment">// 继续调用fromJson</span></span><br><span class="line">  T object = (T) fromJson(jsonReader, typeOfT);</span><br><span class="line">  assertFullConsumption(object, jsonReader);</span><br><span class="line">  <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">fromJson</span><span class="params">(JsonReader reader, Type typeOfT)</span> <span class="keyword">throws</span> JsonIOException, JsonSyntaxException </span>&#123;</span><br><span class="line">  <span class="keyword">boolean</span> isEmpty = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">boolean</span> oldLenient = reader.isLenient();</span><br><span class="line">  reader.setLenient(<span class="keyword">true</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 核心代码在try catch内，我们得到的JsonReader需要通过TypeAdapter的read方法转为Java对象</span></span><br><span class="line">    <span class="comment">// 所以接下来需要分析JsonReader的功能，以及这里默认使用的TypeAdapter的功能</span></span><br><span class="line">    reader.peek();</span><br><span class="line">    isEmpty = <span class="keyword">false</span>;</span><br><span class="line">    TypeToken&lt;T&gt; typeToken = (TypeToken&lt;T&gt;) TypeToken.get(typeOfT);</span><br><span class="line">    TypeAdapter&lt;T&gt; typeAdapter = getAdapter(typeToken);</span><br><span class="line">    T object = typeAdapter.read(reader);</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (EOFException e) &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * For compatibility with JSON 1.5 and earlier, we return null for empty</span></span><br><span class="line"><span class="comment">     * documents instead of throwing.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (isEmpty) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> JsonSyntaxException(e);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> JsonSyntaxException(e);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="comment">// TODO(inder): Figure out whether it is indeed right to rethrow this as JsonSyntaxException</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> JsonSyntaxException(e);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (AssertionError e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">"AssertionError (GSON "</span> + GsonBuildConfig.VERSION + <span class="string">"): "</span> + e.getMessage(), e);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    reader.setLenient(oldLenient);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JsonReader并不是直接通过String解析出来的，首先经过了StringReader，那么先看看StringReader的构造，StringReader继承自Reader，需要实现read方法，read方法一般是用于读取字符到buffer中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// StringReader.java 这里只保存了String的值和长度</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates a new string reader.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s  String providing the character stream.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringReader</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.str = s;</span><br><span class="line">        <span class="keyword">this</span>.length = s.length();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>JsonReader并不是继承自Reader，JsonReader需要配合TypeAdapter使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Gson.java newJsonReader将StringReader转为JsonReader对象，DEFAULT_LENIENT为false，暂时不明白</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns a new JSON reader configured for the settings on this Gson instance.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> JsonReader <span class="title">newJsonReader</span><span class="params">(Reader reader)</span> </span>&#123;</span><br><span class="line">    JsonReader jsonReader = <span class="keyword">new</span> JsonReader(reader);</span><br><span class="line">    jsonReader.setLenient(lenient);</span><br><span class="line">    <span class="keyword">return</span> jsonReader;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>getAdapter方法如何获取到TypeAdapter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the type adapter for &#123;<span class="doctag">@code</span>&#125; type.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException if this GSON cannot serialize and</span></span><br><span class="line"><span class="comment"> *     deserialize &#123;<span class="doctag">@code</span> type&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">TypeAdapter&lt;T&gt; <span class="title">getAdapter</span><span class="params">(TypeToken&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 初始情况下typeTokenCache为空</span></span><br><span class="line">  TypeAdapter&lt;?&gt; cached = typeTokenCache.get(type == <span class="keyword">null</span> ? NULL_KEY_SURROGATE : type);</span><br><span class="line">  <span class="keyword">if</span> (cached != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (TypeAdapter&lt;T&gt;) cached;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// calls初始也为空</span></span><br><span class="line">  Map&lt;TypeToken&lt;?&gt;, FutureTypeAdapter&lt;?&gt;&gt; threadCalls = calls.get();</span><br><span class="line">  <span class="keyword">boolean</span> requiresThreadLocalCleanup = <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (threadCalls == <span class="keyword">null</span>) &#123;</span><br><span class="line">    threadCalls = <span class="keyword">new</span> HashMap&lt;TypeToken&lt;?&gt;, FutureTypeAdapter&lt;?&gt;&gt;();</span><br><span class="line">    calls.set(threadCalls);</span><br><span class="line">    requiresThreadLocalCleanup = <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ThreadLocal在这里是防止老是执行for (TypeAdapterFactory factory : factories) 递归查找，</span></span><br><span class="line">  <span class="comment">// 如果不用ThreadLocal干预的话，就会导致堆栈溢出</span></span><br><span class="line">  <span class="comment">// the key and value type parameters always agree</span></span><br><span class="line">  FutureTypeAdapter&lt;T&gt; ongoingCall = (FutureTypeAdapter&lt;T&gt;) threadCalls.get(type);</span><br><span class="line">  <span class="keyword">if</span> (ongoingCall != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> ongoingCall;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    FutureTypeAdapter&lt;T&gt; call = <span class="keyword">new</span> FutureTypeAdapter&lt;T&gt;();</span><br><span class="line">    threadCalls.put(type, call);</span><br><span class="line">    <span class="comment">// TypeAdapter是从Gson初始化的factories中按照顺序遍历得到的，</span></span><br><span class="line">    <span class="comment">// 所以接下来需要看这里使用的是哪个TypeAdapterFactory</span></span><br><span class="line">    <span class="keyword">for</span> (TypeAdapterFactory factory : factories) &#123;</span><br><span class="line">      TypeAdapter&lt;T&gt; candidate = factory.create(<span class="keyword">this</span>, type);</span><br><span class="line">      <span class="keyword">if</span> (candidate != <span class="keyword">null</span>) &#123;</span><br><span class="line">        call.setDelegate(candidate);</span><br><span class="line">        typeTokenCache.put(type, candidate);</span><br><span class="line">        <span class="keyword">return</span> candidate;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"GSON ("</span> + GsonBuildConfig.VERSION + <span class="string">") cannot handle "</span> + type);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    threadCalls.remove(type);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (requiresThreadLocalCleanup) &#123;</span><br><span class="line">      calls.remove();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ReflectiveTypeAdapterFactory的create方法得到我们处理WeatherEntity的TypeAdapter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ReflectiveTypeAdapterFactory.java create方法返回的是Adapter</span></span><br><span class="line">  <span class="meta">@Override</span> <span class="keyword">public</span> &lt;T&gt; <span class="function">TypeAdapter&lt;T&gt; <span class="title">create</span><span class="params">(Gson gson, <span class="keyword">final</span> TypeToken&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">    Class&lt;? <span class="keyword">super</span> T&gt; raw = type.getRawType();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!Object<span class="class">.<span class="keyword">class</span>.<span class="title">isAssignableFrom</span>(<span class="title">raw</span>)) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>; <span class="comment">// it's a primitive!</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ObjectConstructor&lt;T&gt; constructor = constructorConstructor.get(type);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Adapter&lt;T&gt;(constructor, getBoundFields(gson, type, raw));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Adapter的read方法就是返回WeatherEntity的位置</span></span><br><span class="line">    Adapter(ObjectConstructor&lt;T&gt; constructor, Map&lt;String, BoundField&gt; boundFields) &#123;</span><br><span class="line">      <span class="keyword">this</span>.constructor = constructor;</span><br><span class="line">      <span class="keyword">this</span>.boundFields = boundFields;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// read实际上是被递归调用的</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> T <span class="title">read</span><span class="params">(JsonReader in)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="comment">// JsonReader中保存了我们需要解析的字符串数据，所以也封装了一些读取的函数，</span></span><br><span class="line">      <span class="comment">// 通过peek判断JsonReader是否已经读到结尾了来结束解析的过程</span></span><br><span class="line">      <span class="keyword">if</span> (in.peek() == JsonToken.NULL) &#123;</span><br><span class="line">        in.nextNull();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 两个类ObjectConstructor和BoundField，看名字就知道了ObjectConstructor</span></span><br><span class="line">      <span class="comment">// 用于构造实例，BoundField用于指定属性</span></span><br><span class="line">      T instance = constructor.construct();</span><br><span class="line">    </span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// JsonReader有几个方法，比如beginObject和beginArray，表明要开始解析</span></span><br><span class="line">        <span class="comment">// JsonReader的数据了，beginObject表明需要解析为对象，beginArray表明需要解析为</span></span><br><span class="line">        <span class="comment">// 数组</span></span><br><span class="line">        in.beginObject();</span><br><span class="line">        <span class="comment">// hasNext表明数据是否到达结尾</span></span><br><span class="line">        <span class="keyword">while</span> (in.hasNext()) &#123;</span><br><span class="line">          <span class="comment">// nextName可以获取json数据中的key</span></span><br><span class="line">          String name = in.nextName();</span><br><span class="line">          <span class="comment">// 通过将name转为BoundField，为后续生成属性做铺垫</span></span><br><span class="line">          BoundField field = boundFields.get(name);</span><br><span class="line">          <span class="comment">// 如果不能生成此属性或者不允许反序列化，则跳过此key对应的value数据</span></span><br><span class="line">          <span class="keyword">if</span> (field == <span class="keyword">null</span> || !field.deserialized) &#123;</span><br><span class="line">            in.skipValue();</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 然后需要对属性进行赋值，因此需要看BoundField的read方法做了些什么</span></span><br><span class="line">            field.read(in, instance);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> JsonSyntaxException(e);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(e);</span><br><span class="line">      &#125;</span><br><span class="line">      in.endObject();</span><br><span class="line">      <span class="comment">// 最后返回我们的实例</span></span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BoundField来源于getBoundFields方法</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> Map&lt;String, BoundField&gt; <span class="title">getBoundFields</span><span class="params">(Gson context, TypeToken&lt;?&gt; type, Class&lt;?&gt; raw)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, BoundField&gt; result = <span class="keyword">new</span> LinkedHashMap&lt;String, BoundField&gt;();</span><br><span class="line">    <span class="keyword">if</span> (raw.isInterface()) &#123;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Type declaredType = type.getType();</span><br><span class="line">    <span class="keyword">while</span> (raw != Object<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 首先获得我们自定义WeatherEntity的属性</span></span><br><span class="line">      Field[] fields = raw.getDeclaredFields();</span><br><span class="line">      <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">        <span class="comment">// 对于每一个属性我们通过Excluder判断是否有@Expose或者其他注解修饰</span></span><br><span class="line">        <span class="comment">// 根据注解的要求保存这个属性是否支持序列化serialize和反序列化deserialize</span></span><br><span class="line">        <span class="keyword">boolean</span> serialize = excludeField(field, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">boolean</span> deserialize = excludeField(field, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (!serialize &amp;&amp; !deserialize) &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        accessor.makeAccessible(field);</span><br><span class="line">        Type fieldType = $Gson$Types.resolve(type.getType(), raw, field.getGenericType());</span><br><span class="line">        <span class="comment">// 因为Gson支持序列化时指定key的名称，所以会有一些替代名称，替代名称可以有多个，因此需要</span></span><br><span class="line">        <span class="comment">// 通过getFieldNames获取属性的所有序列化时的名称列表（第一个为属性名，其他可以是设置的替代名称）</span></span><br><span class="line">        List&lt;String&gt; fieldNames = getFieldNames(field);</span><br><span class="line">        BoundField previous = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = fieldNames.size(); i &lt; size; ++i) &#123;</span><br><span class="line">          String name = fieldNames.get(i);</span><br><span class="line">          <span class="keyword">if</span> (i != <span class="number">0</span>) serialize = <span class="keyword">false</span>; <span class="comment">// only serialize the default name</span></span><br><span class="line">          <span class="comment">// result的value boundField是通过createBoundField得到的，且只有第一个名称允许序列化</span></span><br><span class="line">          BoundField boundField = createBoundField(context, field, name,</span><br><span class="line">              TypeToken.get(fieldType), serialize, deserialize);</span><br><span class="line">          BoundField replaced = result.put(name, boundField);</span><br><span class="line">          <span class="keyword">if</span> (previous == <span class="keyword">null</span>) previous = replaced;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (previous != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(declaredType</span><br><span class="line">              + <span class="string">" declares multiple JSON fields named "</span> + previous.name);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      type = TypeToken.get($Gson$Types.resolve(type.getType(), raw, raw.getGenericSuperclass()));</span><br><span class="line">      raw = type.getRawType();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createBoundField返回我们需要的BoundField</span></span><br><span class="line">  <span class="keyword">private</span> ReflectiveTypeAdapterFactory.<span class="function">BoundField <span class="title">createBoundField</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">final</span> Gson context, <span class="keyword">final</span> Field field, <span class="keyword">final</span> String name,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">final</span> TypeToken&lt;?&gt; fieldType, <span class="keyword">boolean</span> serialize, <span class="keyword">boolean</span> deserialize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> isPrimitive = Primitives.isPrimitive(fieldType.getRawType());</span><br><span class="line">    <span class="comment">// special casing primitives here saves ~5% on Android...</span></span><br><span class="line">    JsonAdapter annotation = field.getAnnotation(JsonAdapter<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    TypeAdapter&lt;?&gt; mapped = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (annotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">      mapped = jsonAdapterFactory.getTypeAdapter(</span><br><span class="line">          constructorConstructor, context, fieldType, annotation);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// mapped也是通过getAdapter获取的，但是fieldType已经改变了，变成了我们定义的实体类的下一级</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> jsonAdapterPresent = mapped != <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (mapped == <span class="keyword">null</span>) mapped = context.getAdapter(fieldType);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> TypeAdapter&lt;?&gt; typeAdapter = mapped;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ReflectiveTypeAdapterFactory.BoundField(name, serialize, deserialize) &#123;</span><br><span class="line">      <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"unchecked"</span>, <span class="string">"rawtypes"</span>&#125;) <span class="comment">// the type adapter and field type always agree</span></span><br><span class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(JsonWriter writer, Object value)</span></span></span><br><span class="line"><span class="function">          <span class="keyword">throws</span> IOException, IllegalAccessException </span>&#123;</span><br><span class="line">        Object fieldValue = field.get(value);</span><br><span class="line">        TypeAdapter t = jsonAdapterPresent ? typeAdapter</span><br><span class="line">            : <span class="keyword">new</span> TypeAdapterRuntimeTypeWrapper(context, typeAdapter, fieldType.getType());</span><br><span class="line">        t.write(writer, fieldValue);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 在调用read方法时就产生了递归</span></span><br><span class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(JsonReader reader, Object value)</span></span></span><br><span class="line"><span class="function">          <span class="keyword">throws</span> IOException, IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="comment">// 由于属性的类型不同，此处的typeAdapter变为从factories遍历获取，</span></span><br><span class="line">        <span class="comment">// 如果我们这里的reader是String，那么typeAdapter为TypeAdapters.STRING_FACTORY</span></span><br><span class="line">        <span class="comment">// 然后按照TypeAdapters.STRING_FACTORY的逻辑读取数据</span></span><br><span class="line">        Object fieldValue = typeAdapter.read(reader);</span><br><span class="line">        <span class="keyword">if</span> (fieldValue != <span class="keyword">null</span> || !isPrimitive) &#123;</span><br><span class="line">          <span class="comment">// set方法把值fieldValue赋给对象value</span></span><br><span class="line">          field.set(value, fieldValue);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">writeField</span><span class="params">(Object value)</span> <span class="keyword">throws</span> IOException, IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!serialized) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        Object fieldValue = field.get(value);</span><br><span class="line">        <span class="keyword">return</span> fieldValue != value; <span class="comment">// avoid recursion for example for Throwable.cause</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>我们目前知道了属性是通过getDeclaredFields拿到的，然后通过递归的方式调用typeAdapter的read方法，然后将从JsonReader中获取到的值赋给属性，关键是属性实例是如何得到的<code>T instance = constructor.construct();</code>，默认情况下是ConstructorConstructor，通过ConstructorConstructor构造某个属性的实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConstructorConstructor.java 默认instanceCreators为空</span></span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; <span class="function">ObjectConstructor&lt;T&gt; <span class="title">get</span><span class="params">(TypeToken&lt;T&gt; typeToken)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Type type = typeToken.getType();</span><br><span class="line">    <span class="keyword">final</span> Class&lt;? <span class="keyword">super</span> T&gt; rawType = typeToken.getRawType();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// first try an instance creator</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) <span class="comment">// types must agree</span></span><br><span class="line">    <span class="keyword">final</span> InstanceCreator&lt;T&gt; typeCreator = (InstanceCreator&lt;T&gt;) instanceCreators.get(type);</span><br><span class="line">    <span class="keyword">if</span> (typeCreator != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ObjectConstructor&lt;T&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> T <span class="title">construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> typeCreator.createInstance(type);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Next try raw type match for instance creators</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) <span class="comment">// types must agree</span></span><br><span class="line">    <span class="keyword">final</span> InstanceCreator&lt;T&gt; rawTypeCreator =</span><br><span class="line">        (InstanceCreator&lt;T&gt;) instanceCreators.get(rawType);</span><br><span class="line">    <span class="keyword">if</span> (rawTypeCreator != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ObjectConstructor&lt;T&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> T <span class="title">construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> rawTypeCreator.createInstance(type);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 我们构造的实例一般是通过newDefaultConstructor得到的</span></span><br><span class="line">    ObjectConstructor&lt;T&gt; defaultConstructor = newDefaultConstructor(rawType);</span><br><span class="line">    <span class="keyword">if</span> (defaultConstructor != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> defaultConstructor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// newDefaultImplementationConstructor用于构造Map和List以及它们的父类接口的实例</span></span><br><span class="line">    ObjectConstructor&lt;T&gt; defaultImplementation = newDefaultImplementationConstructor(type, rawType);</span><br><span class="line">    <span class="keyword">if</span> (defaultImplementation != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> defaultImplementation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// finally try unsafe</span></span><br><span class="line">    <span class="keyword">return</span> newUnsafeAllocator(type, rawType);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> &lt;T&gt; <span class="function">ObjectConstructor&lt;T&gt; <span class="title">newDefaultConstructor</span><span class="params">(Class&lt;? <span class="keyword">super</span> T&gt; rawType)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// getDeclaredConstructor通过反射得到目标类的构造函数</span></span><br><span class="line">      <span class="keyword">final</span> Constructor&lt;? <span class="keyword">super</span> T&gt; constructor = rawType.getDeclaredConstructor();</span><br><span class="line">      <span class="keyword">if</span> (!constructor.isAccessible()) &#123;</span><br><span class="line">        accessor.makeAccessible(constructor);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ObjectConstructor&lt;T&gt;() &#123;</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) <span class="comment">// T is the same raw type as is requested</span></span><br><span class="line">        <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> T <span class="title">construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            Object[] args = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">// 返回初始参数都为null的实例</span></span><br><span class="line">            <span class="keyword">return</span> (T) constructor.newInstance(args);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> JsonParseException ?</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Failed to invoke "</span> + constructor + <span class="string">" with no args"</span>, e);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> don't wrap if cause is unchecked!</span></span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> JsonParseException ?</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Failed to invoke "</span> + constructor + <span class="string">" with no args"</span>,</span><br><span class="line">                e.getTargetException());</span><br><span class="line">          &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>读取json字符串的工作是由JsonReader完成的，以解析下面此json字符串为例（删减版），服务器传过来的数据可能没有换行</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"HeWeather6"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"basic"</span>: &#123;</span><br><span class="line">                <span class="attr">"cid"</span>: <span class="string">"CN101010100"</span>,</span><br><span class="line">                <span class="attr">"location"</span>: <span class="string">"北京"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"update"</span>: &#123;</span><br><span class="line">                <span class="attr">"loc"</span>: <span class="string">"2019-07-18 16:45"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"status"</span>: <span class="string">"ok"</span></span><br><span class="line">        &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据上文代码分析我们知道解析数据的起点是ReflectiveTypeAdapterFactory中Adapter的read方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> T <span class="title">read</span><span class="params">(JsonReader in)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (in.peek() == JsonToken.NULL) &#123;</span><br><span class="line">    in.nextNull();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  T instance = constructor.construct();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 从in.beginObject开始对json数据进行解析</span></span><br><span class="line">    in.beginObject();</span><br><span class="line">    <span class="keyword">while</span> (in.hasNext()) &#123;</span><br><span class="line">      String name = in.nextName();</span><br><span class="line">      <span class="comment">// 14. 得到解析的key后构造属性</span></span><br><span class="line">      BoundField field = boundFields.get(name);</span><br><span class="line">      <span class="keyword">if</span> (field == <span class="keyword">null</span> || !field.deserialized) &#123;</span><br><span class="line">        in.skipValue();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 15. 并且递归解析后面的数据，深度优先，这里会调用CollectionTypeAdapterFactory的Adapter的read方法</span></span><br><span class="line">        <span class="comment">// CollectionTypeAdapterFactory用于处理集合类数据，这里会调用peek方法</span></span><br><span class="line">        field.read(in, instance);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> JsonSyntaxException(e);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(e);</span><br><span class="line">  &#125;</span><br><span class="line">  in.endObject();</span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JsonReader.java peeked是标志位，初始为PEEKED_NONE，表明还没有开始任何解析过程</span></span><br><span class="line"><span class="comment">// JsonReader解析数据的过程很有意思，它是依靠peeked标志位来决定如何处理下一个字符，</span></span><br><span class="line"><span class="comment">// peeked初始值为PEEKED_NONE，表明标志位为空所以需要读取json数据，根据读取的字符设置peeked</span></span><br><span class="line"><span class="comment">// 的值，然后再根据peeked的值决定下一个字符如何处理</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Consumes the next token from the JSON stream and asserts that it is the</span></span><br><span class="line"><span class="comment">   * beginning of a new object.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beginObject</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = peeked;</span><br><span class="line">    <span class="keyword">if</span> (p == PEEKED_NONE) &#123;</span><br><span class="line">      <span class="comment">// 初始值peeked为PEEKED_NONE，调用doPeek方法设置peeked的标志</span></span><br><span class="line">      p = doPeek();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (p == PEEKED_BEGIN_OBJECT) &#123;</span><br><span class="line">      <span class="comment">// 4. 由于doPeek将p置为PEEKED_BEGIN_OBJECT，所以需要将JsonScope.EMPTY_OBJECT</span></span><br><span class="line">      <span class="comment">// 加入stack中，并peeked重置为PEEKED_NONE</span></span><br><span class="line">      push(JsonScope.EMPTY_OBJECT);</span><br><span class="line">      peeked = PEEKED_NONE;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Expected BEGIN_OBJECT but was "</span> + peek() + locationString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// doPeek是整个解析过程中的核心代码，其他的函数都会调用到doPeek</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">doPeek</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 除了有peeked标志还有stack数组，stack数组保存解析json数据的进度，stack初始值全为0，</span></span><br><span class="line">    <span class="comment">// 初始化后将stack[0]置为JsonScope.EMPTY_DOCUMENT，表明还未开始解析</span></span><br><span class="line">    <span class="comment">// 6. 在hasNext方法中再次执行doPeek，此时peekStack为JsonScope.NONEMPTY_OBJECT</span></span><br><span class="line">    <span class="keyword">int</span> peekStack = stack[stackSize - <span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 25. stack的top被置为JsonScope.EMPTY_ARRAY，表明期望的数据是Array</span></span><br><span class="line">    <span class="keyword">if</span> (peekStack == JsonScope.EMPTY_ARRAY) &#123;</span><br><span class="line">      <span class="comment">// 继续重置stack top为JsonScope.NONEMPTY_ARRAY</span></span><br><span class="line">      stack[stackSize - <span class="number">1</span>] = JsonScope.NONEMPTY_ARRAY;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (peekStack == JsonScope.NONEMPTY_ARRAY) &#123;</span><br><span class="line">      <span class="comment">// Look for a comma before the next element.</span></span><br><span class="line">      <span class="keyword">int</span> c = nextNonWhitespace(<span class="keyword">true</span>);</span><br><span class="line">      <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">']'</span>:</span><br><span class="line">        <span class="keyword">return</span> peeked = PEEKED_END_ARRAY;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">';'</span>:</span><br><span class="line">        checkLenient(); <span class="comment">// fall-through</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">','</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> syntaxError(<span class="string">"Unterminated array"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (peekStack == JsonScope.EMPTY_OBJECT || peekStack == JsonScope.NONEMPTY_OBJECT) &#123;</span><br><span class="line">      <span class="comment">// 7. 又将stack的top置为JsonScope.DANGLING_NAME</span></span><br><span class="line">      stack[stackSize - <span class="number">1</span>] = JsonScope.DANGLING_NAME;</span><br><span class="line">      <span class="comment">// Look for a comma before the next element.</span></span><br><span class="line">      <span class="keyword">if</span> (peekStack == JsonScope.NONEMPTY_OBJECT) &#123;</span><br><span class="line">        <span class="keyword">int</span> c = nextNonWhitespace(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'&#125;'</span>:</span><br><span class="line">          <span class="keyword">return</span> peeked = PEEKED_END_OBJECT;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">';'</span>:</span><br><span class="line">          checkLenient(); <span class="comment">// fall-through</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">','</span>:</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">throw</span> syntaxError(<span class="string">"Unterminated object"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 8. 读取下一个字符 "</span></span><br><span class="line">      <span class="keyword">int</span> c = nextNonWhitespace(<span class="keyword">true</span>);</span><br><span class="line">      <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'"'</span>:</span><br><span class="line">      <span class="comment">// 9. 显然将peeked置为PEEKED_DOUBLE_QUOTED_NAME</span></span><br><span class="line">        <span class="keyword">return</span> peeked = PEEKED_DOUBLE_QUOTED_NAME;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'\''</span>:</span><br><span class="line">        checkLenient();</span><br><span class="line">        <span class="keyword">return</span> peeked = PEEKED_SINGLE_QUOTED_NAME;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'&#125;'</span>:</span><br><span class="line">        <span class="keyword">if</span> (peekStack != JsonScope.NONEMPTY_OBJECT) &#123;</span><br><span class="line">          <span class="keyword">return</span> peeked = PEEKED_END_OBJECT;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> syntaxError(<span class="string">"Expected name"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        checkLenient();</span><br><span class="line">        pos--; <span class="comment">// Don't consume the first character in an unquoted string.</span></span><br><span class="line">        <span class="keyword">if</span> (isLiteral((<span class="keyword">char</span>) c)) &#123;</span><br><span class="line">          <span class="keyword">return</span> peeked = PEEKED_UNQUOTED_NAME;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> syntaxError(<span class="string">"Expected name"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (peekStack == JsonScope.DANGLING_NAME) &#123;</span><br><span class="line">      <span class="comment">// 17. 之前stack的top被置为JsonScope.DANGLING_NAME</span></span><br><span class="line">      <span class="comment">// 然后stack的top置为JsonScope.NONEMPTY_OBJECT，表明object对象还没有读取完成</span></span><br><span class="line">      stack[stackSize - <span class="number">1</span>] = JsonScope.NONEMPTY_OBJECT;</span><br><span class="line">      <span class="comment">// Look for a colon before the value.</span></span><br><span class="line">      <span class="comment">// 下一个字符是 :</span></span><br><span class="line">      <span class="keyword">int</span> c = nextNonWhitespace(<span class="keyword">true</span>);</span><br><span class="line">      <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">':'</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'='</span>:</span><br><span class="line">        checkLenient();</span><br><span class="line">        <span class="keyword">if</span> ((pos &lt; limit || fillBuffer(<span class="number">1</span>)) &amp;&amp; buffer[pos] == <span class="string">'&gt;'</span>) &#123;</span><br><span class="line">          pos++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> syntaxError(<span class="string">"Expected ':'"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (peekStack == JsonScope.EMPTY_DOCUMENT) &#123;</span><br><span class="line">      <span class="comment">// 1. peekStack初始为JsonScope.EMPTY_DOCUMENT</span></span><br><span class="line">      <span class="keyword">if</span> (lenient) &#123;</span><br><span class="line">        <span class="comment">// lenient在调用read方法之前被置为true，结束后被置为false</span></span><br><span class="line">        consumeNonExecutePrefix();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// stack[0]被置为JsonScope.NONEMPTY_DOCUMENT</span></span><br><span class="line">      stack[stackSize - <span class="number">1</span>] = JsonScope.NONEMPTY_DOCUMENT;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (peekStack == JsonScope.NONEMPTY_DOCUMENT) &#123;</span><br><span class="line">      <span class="keyword">int</span> c = nextNonWhitespace(<span class="keyword">false</span>);</span><br><span class="line">      <span class="keyword">if</span> (c == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> peeked = PEEKED_EOF;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        checkLenient();</span><br><span class="line">        pos--;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (peekStack == JsonScope.CLOSED) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"JsonReader is closed"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. c是第一个字符 &#123;</span></span><br><span class="line">    <span class="comment">// 18. c是 [</span></span><br><span class="line">    <span class="comment">// 26. c是 &#123;</span></span><br><span class="line">    <span class="keyword">int</span> c = nextNonWhitespace(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">']'</span>:</span><br><span class="line">      <span class="keyword">if</span> (peekStack == JsonScope.EMPTY_ARRAY) &#123;</span><br><span class="line">        <span class="keyword">return</span> peeked = PEEKED_END_ARRAY;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// fall-through to handle ",]"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">';'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">','</span>:</span><br><span class="line">      <span class="comment">// In lenient mode, a 0-length literal in an array means 'null'.</span></span><br><span class="line">      <span class="keyword">if</span> (peekStack == JsonScope.EMPTY_ARRAY || peekStack == JsonScope.NONEMPTY_ARRAY) &#123;</span><br><span class="line">        checkLenient();</span><br><span class="line">        pos--;</span><br><span class="line">        <span class="keyword">return</span> peeked = PEEKED_NULL;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> syntaxError(<span class="string">"Unexpected value"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'\''</span>:</span><br><span class="line">      checkLenient();</span><br><span class="line">      <span class="keyword">return</span> peeked = PEEKED_SINGLE_QUOTED;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'"'</span>:</span><br><span class="line">      <span class="keyword">return</span> peeked = PEEKED_DOUBLE_QUOTED;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'['</span>:</span><br><span class="line">    <span class="comment">// 19. 将peeked置为PEEKED_BEGIN_ARRAY</span></span><br><span class="line">    <span class="comment">// 表明开始解析Array类型数据</span></span><br><span class="line">      <span class="keyword">return</span> peeked = PEEKED_BEGIN_ARRAY;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'&#123;'</span>:</span><br><span class="line">    <span class="comment">// 3. peeked被置为PEEKED_BEGIN_OBJECT</span></span><br><span class="line">    <span class="comment">// 27. peeked被置为PEEKED_BEGIN_OBJECT</span></span><br><span class="line">      <span class="keyword">return</span> peeked = PEEKED_BEGIN_OBJECT;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      pos--; <span class="comment">// Don't consume the first character in a literal value.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> result = peekKeyword();</span><br><span class="line">    <span class="keyword">if</span> (result != PEEKED_NONE) &#123;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = peekNumber();</span><br><span class="line">    <span class="keyword">if</span> (result != PEEKED_NONE) &#123;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isLiteral(buffer[pos])) &#123;</span><br><span class="line">      <span class="keyword">throw</span> syntaxError(<span class="string">"Expected value"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    checkLenient();</span><br><span class="line">    <span class="keyword">return</span> peeked = PEEKED_UNQUOTED;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NON_EXECUTE_PREFIX包括")]&#125;'\n"，即如果json字符串第一个字符在NON_EXECUTE_PREFIX中</span></span><br><span class="line"><span class="comment">// 说明这个字符出了错误，buffer是1024长度的数组用于缓存json数据，pos表示我们读取数据的位置，</span></span><br><span class="line"><span class="comment">// consumeNonExecutePrefix用于</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Consumes the non-execute prefix if it exists.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">consumeNonExecutePrefix</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// fast forward through the leading whitespace</span></span><br><span class="line">    nextNonWhitespace(<span class="keyword">true</span>);</span><br><span class="line">    pos--;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pos + NON_EXECUTE_PREFIX.length &gt; limit &amp;&amp; !fillBuffer(NON_EXECUTE_PREFIX.length)) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NON_EXECUTE_PREFIX.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (buffer[pos + i] != NON_EXECUTE_PREFIX[i]) &#123;</span><br><span class="line">        <span class="keyword">return</span>; <span class="comment">// not a security token!</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// we consumed a security token!</span></span><br><span class="line">    pos += NON_EXECUTE_PREFIX.length;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 在while循环里判断hasNext，显然peeked此时为PEEKED_NONE，所以执行doPeek</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns true if the current array or object has another element.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = peeked;</span><br><span class="line">    <span class="keyword">if</span> (p == PEEKED_NONE) &#123;</span><br><span class="line">      p = doPeek();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 10. p为PEEKED_DOUBLE_QUOTED_NAME，显然返回true</span></span><br><span class="line">    <span class="keyword">return</span> p != PEEKED_END_OBJECT &amp;&amp; p != PEEKED_END_ARRAY;</span><br><span class="line">  &#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 11. 然后通过in.nextName()读取json数据</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns the next token, a &#123;<span class="doctag">@link</span> com.google.gson.stream.JsonToken#NAME property name&#125;, and</span></span><br><span class="line"><span class="comment">   * consumes it.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> java.io.IOException if the next token in the stream is not a property</span></span><br><span class="line"><span class="comment">   *     name.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">nextName</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 12. 此时peeked为PEEKED_DOUBLE_QUOTED_NAME</span></span><br><span class="line">    <span class="keyword">int</span> p = peeked;</span><br><span class="line">    <span class="keyword">if</span> (p == PEEKED_NONE) &#123;</span><br><span class="line">      p = doPeek();</span><br><span class="line">    &#125;</span><br><span class="line">    String result;</span><br><span class="line">    <span class="keyword">if</span> (p == PEEKED_UNQUOTED_NAME) &#123;</span><br><span class="line">      result = nextUnquotedValue();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p == PEEKED_SINGLE_QUOTED_NAME) &#123;</span><br><span class="line">      result = nextQuotedValue(<span class="string">'\''</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p == PEEKED_DOUBLE_QUOTED_NAME) &#123;</span><br><span class="line">      <span class="comment">// 13. 调用nextQuotedValue，nextQuotedValue方法读取buffer中不为 " 的字符串，</span></span><br><span class="line">      <span class="comment">// 简而言之就是在已知我们已经读取到双引号的情况下，将两个双引号之间的数据获取到，</span></span><br><span class="line">      <span class="comment">// 所以这里的result为HeWeather6</span></span><br><span class="line">      result = nextQuotedValue(<span class="string">'"'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Expected a name but was "</span> + peek() + locationString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 最后还是需要重置peeked为PEEKED_NONE</span></span><br><span class="line">    peeked = PEEKED_NONE;</span><br><span class="line">    <span class="comment">// 将result保存到pathNames中</span></span><br><span class="line">    pathNames[stackSize - <span class="number">1</span>] = result;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 16. peek继续调用doPeek</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns the type of the next token without consuming it.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> JsonToken <span class="title">peek</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = peeked;</span><br><span class="line">    <span class="keyword">if</span> (p == PEEKED_NONE) &#123;</span><br><span class="line">      p = doPeek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (p) &#123;</span><br><span class="line">    <span class="keyword">case</span> PEEKED_BEGIN_OBJECT:</span><br><span class="line">      <span class="keyword">return</span> JsonToken.BEGIN_OBJECT;</span><br><span class="line">    <span class="keyword">case</span> PEEKED_END_OBJECT:</span><br><span class="line">      <span class="keyword">return</span> JsonToken.END_OBJECT;</span><br><span class="line">    <span class="keyword">case</span> PEEKED_BEGIN_ARRAY:</span><br><span class="line">    <span class="comment">// 20. 返回JsonToken.BEGIN_ARRAY</span></span><br><span class="line">      <span class="keyword">return</span> JsonToken.BEGIN_ARRAY;</span><br><span class="line">    <span class="keyword">case</span> PEEKED_END_ARRAY:</span><br><span class="line">      <span class="keyword">return</span> JsonToken.END_ARRAY;</span><br><span class="line">    <span class="keyword">case</span> PEEKED_SINGLE_QUOTED_NAME:</span><br><span class="line">    <span class="keyword">case</span> PEEKED_DOUBLE_QUOTED_NAME:</span><br><span class="line">    <span class="keyword">case</span> PEEKED_UNQUOTED_NAME:</span><br><span class="line">      <span class="keyword">return</span> JsonToken.NAME;</span><br><span class="line">    <span class="keyword">case</span> PEEKED_TRUE:</span><br><span class="line">    <span class="keyword">case</span> PEEKED_FALSE:</span><br><span class="line">      <span class="keyword">return</span> JsonToken.BOOLEAN;</span><br><span class="line">    <span class="keyword">case</span> PEEKED_NULL:</span><br><span class="line">      <span class="keyword">return</span> JsonToken.NULL;</span><br><span class="line">    <span class="keyword">case</span> PEEKED_SINGLE_QUOTED:</span><br><span class="line">    <span class="keyword">case</span> PEEKED_DOUBLE_QUOTED:</span><br><span class="line">    <span class="keyword">case</span> PEEKED_UNQUOTED:</span><br><span class="line">    <span class="keyword">case</span> PEEKED_BUFFERED:</span><br><span class="line">      <span class="keyword">return</span> JsonToken.STRING;</span><br><span class="line">    <span class="keyword">case</span> PEEKED_LONG:</span><br><span class="line">    <span class="keyword">case</span> PEEKED_NUMBER:</span><br><span class="line">      <span class="keyword">return</span> JsonToken.NUMBER;</span><br><span class="line">    <span class="keyword">case</span> PEEKED_EOF:</span><br><span class="line">      <span class="keyword">return</span> JsonToken.END_DOCUMENT;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 23. beginArray用于解析Array类型数据</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Consumes the next token from the JSON stream and asserts that it is the</span></span><br><span class="line"><span class="comment">   * beginning of a new array.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beginArray</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = peeked;</span><br><span class="line">    <span class="keyword">if</span> (p == PEEKED_NONE) &#123;</span><br><span class="line">      p = doPeek();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 由于peeked被置为PEEKED_BEGIN_ARRAY</span></span><br><span class="line">    <span class="comment">// stack的top被置为JsonScope.EMPTY_ARRAY</span></span><br><span class="line">    <span class="keyword">if</span> (p == PEEKED_BEGIN_ARRAY) &#123;</span><br><span class="line">      push(JsonScope.EMPTY_ARRAY);</span><br><span class="line">      pathIndices[stackSize - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      peeked = PEEKED_NONE;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Expected BEGIN_ARRAY but was "</span> + peek() + locationString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Collection&lt;E&gt; <span class="title">read</span><span class="params">(JsonReader in)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// 21. in.peek()返回JsonToken.BEGIN_ARRAY</span></span><br><span class="line">  <span class="keyword">if</span> (in.peek() == JsonToken.NULL) &#123;</span><br><span class="line">    in.nextNull();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Collection&lt;E&gt; collection = constructor.construct();</span><br><span class="line">  <span class="comment">// 22.所以调用beginArray解析数据</span></span><br><span class="line">  in.beginArray();</span><br><span class="line">  <span class="comment">// 24. 继续判断hasNext，但是还是通过doPeek解析</span></span><br><span class="line">  <span class="keyword">while</span> (in.hasNext()) &#123;</span><br><span class="line">    <span class="comment">// 28. hasNext返回true，elementTypeAdapter是通过gson.getAdapter获取的，</span></span><br><span class="line">    <span class="comment">// 本质上还是ReflectiveTypeAdapterFactory的Adapter的read方法，那么下一个属性的实例化</span></span><br><span class="line">    <span class="comment">// 又进入了递归的模式，与此同时我们对于Array类型的属性是通过构造collection对象来加入下一级的</span></span><br><span class="line">    <span class="comment">// 对象</span></span><br><span class="line">    E instance = elementTypeAdapter.read(in);</span><br><span class="line">    collection.add(instance);</span><br><span class="line">  &#125;</span><br><span class="line">  in.endArray();</span><br><span class="line">  <span class="keyword">return</span> collection;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JsonReader可以完成的内容非常多，基本可以解析大多数的数据，而你只需要调用其中的beginArray、endArray、beginObject、endObject、hasNext等方法就可以得到json字符串中正确的数据部分，而且不需要考虑括号、引号、分号等等，在这些方法中就已经帮你跳过了，所以你也可以自定义json解析规则，实例代码在JsonReader的注释中给出了</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">912345678901</span>,</span><br><span class="line">    <span class="attr">"text"</span>: <span class="string">"How do I read a JSON stream in Java?"</span>,</span><br><span class="line">    <span class="attr">"geo"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"user"</span>: &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"json_newb"</span>,</span><br><span class="line">      <span class="attr">"followers_count"</span>: <span class="number">41</span></span><br><span class="line">     &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">912345678902</span>,</span><br><span class="line">    <span class="attr">"text"</span>: <span class="string">"@json_newb just use JsonReader!"</span>,</span><br><span class="line">    <span class="attr">"geo"</span>: [<span class="number">50.454722</span>, <span class="number">-104.606667</span>],</span><br><span class="line">    <span class="attr">"user"</span>: &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"jesse"</span>,</span><br><span class="line">      <span class="attr">"followers_count"</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Message&gt; <span class="title">readJsonStream</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  JsonReader reader = <span class="keyword">new</span> JsonReader(<span class="keyword">new</span> InputStreamReader(in, <span class="string">"UTF-8"</span>));</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> readMessagesArray(reader);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    reader.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Message&gt; <span class="title">readMessagesArray</span><span class="params">(JsonReader reader)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  List&lt;Message&gt; messages = <span class="keyword">new</span> ArrayList&lt;Message&gt;();</span><br><span class="line"></span><br><span class="line">  reader.beginArray();</span><br><span class="line">  <span class="keyword">while</span> (reader.hasNext()) &#123;</span><br><span class="line">    messages.add(readMessage(reader));</span><br><span class="line">  &#125;</span><br><span class="line">  reader.endArray();</span><br><span class="line">  <span class="keyword">return</span> messages;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Message <span class="title">readMessage</span><span class="params">(JsonReader reader)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="keyword">long</span> id = -<span class="number">1</span>;</span><br><span class="line">  String text = <span class="keyword">null</span>;</span><br><span class="line">  User user = <span class="keyword">null</span>;</span><br><span class="line">  List&lt;Double&gt; geo = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">  reader.beginObject();</span><br><span class="line">  <span class="keyword">while</span> (reader.hasNext()) &#123;</span><br><span class="line">    String name = reader.nextName();</span><br><span class="line">    <span class="keyword">if</span> (name.equals(<span class="string">"id"</span>)) &#123;</span><br><span class="line">      id = reader.nextLong();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">"text"</span>)) &#123;</span><br><span class="line">      text = reader.nextString();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">"geo"</span>) &amp;&amp; reader.peek() != JsonToken.NULL) &#123;</span><br><span class="line">      geo = readDoublesArray(reader);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">"user"</span>)) &#123;</span><br><span class="line">      user = readUser(reader);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      reader.skipValue();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  reader.endObject();</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Message(id, text, user, geo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Double&gt; <span class="title">readDoublesArray</span><span class="params">(JsonReader reader)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  List&lt;Double&gt; doubles = <span class="keyword">new</span> ArrayList&lt;Double&gt;();</span><br><span class="line"></span><br><span class="line">  reader.beginArray();</span><br><span class="line">  <span class="keyword">while</span> (reader.hasNext()) &#123;</span><br><span class="line">    doubles.add(reader.nextDouble());</span><br><span class="line">  &#125;</span><br><span class="line">  reader.endArray();</span><br><span class="line">  <span class="keyword">return</span> doubles;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">readUser</span><span class="params">(JsonReader reader)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  String username = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">int</span> followersCount = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  reader.beginObject();</span><br><span class="line">  <span class="keyword">while</span> (reader.hasNext()) &#123;</span><br><span class="line">    String name = reader.nextName();</span><br><span class="line">    <span class="keyword">if</span> (name.equals(<span class="string">"name"</span>)) &#123;</span><br><span class="line">      username = reader.nextString();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">"followers_count"</span>)) &#123;</span><br><span class="line">      followersCount = reader.nextInt();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      reader.skipValue();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  reader.endObject();</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> User(username, followersCount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上就是Gson解析json数据并实例化的过程，反之toJson将实例转为json数据也差不多。解析json数据是一个深度优先遍历的过程，同时根据各种括号、分号、引号判断数据类型以及数据的值，Gson在解析的过程中有一些非常亮眼的设计思路：</p>
<ol>
<li>TypeAdapterFactory工厂类，用于提供TypeAdapter，TypeAdapter用于将json数据转为实例，由于Java中包含大量的基础类型和自定义类型，所以Gson提供了对应的基础类型的TypeAdapterFactory工厂，这些工厂提供的Adapter可以按照设计好的方式调用JsonReader的各种方法读取数据并转为实例；同时对于自定义类型，提供了ReflectiveTypeAdapterFactory，通过反射的方式构造实例，同时根据不同的属性的类型，又可以使用TypeToken来表示便于后续查找合适的TypeAdapter；</li>
<li>JsonReader的强大功能，为了获取到json数据中的有效数据，比如属性名称、属性的值以及属性的类型，JsonReader加入了两个非常关键的参数peeked和stack，peeked用于标志当前的解析步骤是否完成，比如在调用beginObject后，peeked经历PEEKED_NONE -&gt; PEEKED_BEGIN_OBJECT -&gt; PEEKED_NONE的过程，通过doPeek完成这些步骤的转换，只要最终为PEEKED_NONE，说明前面都没有发生错误；其次是stack，stack保存了当前进行的流程，比如JsonScope.EMPTY_ARRAY、JsonScope.NONEMPTY_ARRAY、JsonScope.NONEMPTY_OBJECT等等，通过doPeek判断字符串，我们就知道了当前json数据可能是属于什么类型，从而将符号进行划分再判断，减少了需要判断的条件。</li>
</ol>

    </div>

    
    
    
      
  <div class="popular-posts-header">推荐文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/archives/d1370632.html" rel="bookmark">Material组件-Snackbar</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/archives/c75dc4ab.html" rel="bookmark">Android IPC-AIDL、Messenger和Socket</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/archives/2943f9f3.html" rel="bookmark">Android-共享元素动画效果</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/archives/bb3604db.html" rel="bookmark">Android-Q适配-存储方式</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/archives/e182bde6.html" rel="bookmark">Material组件-Menu</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Tao Zhou
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://zhoutao822.coding.me/archives/b0107659.html" title="Android框架-Gson">http://zhoutao822.coding.me/archives/b0107659.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
              <a href="/tags/Gson/" rel="tag"># Gson</a>
              <a href="/tags/json/" rel="tag"># json</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/archives/6c51e275.html" rel="prev" title="Android框架-Retrofit与OkHttp">
      <i class="fa fa-chevron-left"></i> Android框架-Retrofit与OkHttp
    </a></div>
      <div class="post-nav-item">
    <a href="/archives/d1370632.html" rel="next" title="Material组件-Snackbar">
      Material组件-Snackbar <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Gson使用"><span class="nav-text">1. Gson使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Gson源码分析"><span class="nav-text">2. Gson源码分析</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tao Zhou"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Tao Zhou</p>
  <div class="site-description" itemprop="description">学习笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">63</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">132</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tao Zhou</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">890k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">13:29</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.7.0
  </div>

        






  <script>
  function leancloudSelector(url) {
    url = encodeURI(url);
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.getAttribute('id'));
      var title = visitors.getAttribute('data-flag-title');

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
              leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .catch(error => {
                console.error('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.getAttribute('id'));
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=iyNzyQRx6yCU5YQVEXPl0hSe-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'iyNzyQRx6yCU5YQVEXPl0hSe-gzGzoHsz',
            'X-LC-Key': 'xoukWFyqvFIXJ6DfxLLYtsTP',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      
<script type="text/x-mathjax-config">
    MathJax.Ajax.config.path['mhchem'] = '//cdn.jsdelivr.net/npm/mathjax-mhchem@3';

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        extensions: ['[mhchem]/mhchem.js'],
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el: '#valine-comments',
      verify: false,
      notify: false,
      appId: 'iyNzyQRx6yCU5YQVEXPl0hSe-gzGzoHsz',
      appKey: 'xoukWFyqvFIXJ6DfxLLYtsTP',
      placeholder: "Just go go",
      avatar: 'mm',
      meta: guest,
      pageSize: '10' || 10,
      visitor: false,
      lang: 'zh-cn' || 'zh-cn',
      path: location.pathname,
      recordIP: true,
      serverURLs: ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
